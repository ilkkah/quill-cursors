!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.QuillCursors=e():t.QuillCursors=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=n.n(r),i={template:['<span class="ql-cursor-selections"></span>','<span class="ql-cursor-caret-container">','  <span class="ql-cursor-caret"></span>',"</span>",'<div class="ql-cursor-flag">','  <small class="ql-cursor-name"></small>','  <span class="ql-cursor-flag-flap"></span>',"</div>"].join(""),autoRegisterListener:!0,hideDelay:3e3,hideSpeed:400};function s(t,e){this.quill=t,this._initOptions(e),this.cursors={},this.container=this.quill.addContainer("ql-cursors"),this.options.autoRegisterListener&&this.registerTextChangeListener(),window.addEventListener("resize",this.update.bind(this))}s.prototype.registerTextChangeListener=function(){this.quill.on(this.quill.constructor.events.TEXT_CHANGE,this._applyDelta.bind(this))},s.prototype.clearCursors=function(){Object.keys(this.cursors).forEach(this.removeCursor.bind(this))},s.prototype.moveCursor=function(t,e){var n=this.cursors[t];n&&(n.range=e,n.el.classList.remove("hidden"),this._updateCursor(n))},s.prototype.removeCursor=function(t){var e=this.cursors[t];e&&e.el.parentNode.removeChild(e.el),delete this.cursors[t]},s.prototype.setCursor=function(t,e,n,r){return this.cursors[t]||(this.cursors[t]={userId:t,color:r,range:e,el:null,selectionEl:null,caretEl:null,flagEl:null},this._buildCursor(t,n)),window.setTimeout(function(){this.moveCursor(t,e)}.bind(this)),this.cursors[t]},s.prototype.shiftCursors=function(t,e){var n;Object.keys(this.cursors).forEach(function(r){(n=this.cursors[r])&&n.range&&(e>0||0==n.range.length?this._shiftCursor(r,t-1,e):this._shiftCursor(r,t,e))},this)},s.prototype.update=function(){Object.keys(this.cursors).map(function(t){this._updateCursor(this.cursors[t])}.bind(this))},s.prototype._initOptions=function(t){this.options=i,this.options.template=t.template||this.options.template,this.options.autoRegisterListener=0==t.autoRegisterListener?t.autoRegisterListener:this.options.autoRegisterListener,this.options.hideDelay=void 0==t.hideDelay?this.options.hideDelay:t.hideDelay,this.options.hideSpeed=void 0==t.hideSpeed?this.options.hideSpeed:t.hideSpeed},s.prototype._applyDelta=function(t){var e=0;t.ops.forEach(function(t){var n=0;t.insert?(n=t.insert.length||1,this.shiftCursors(e,n)):t.delete?this.shiftCursors(e,-1*t.delete):t.retain&&(n=t.retain),e+=n},this),this.update()},s.prototype._buildCursor=function(t,e){var n,r,o,i=this.cursors[t],s=document.createElement("span");s.classList.add("ql-cursor"),s.innerHTML=this.options.template,n=s.querySelector(".ql-cursor-selections"),r=s.querySelector(".ql-cursor-caret-container"),(o=s.querySelector(".ql-cursor-flag")).style.backgroundColor=i.color,r.querySelector(".ql-cursor-caret").style.backgroundColor=i.color,s.querySelector(".ql-cursor-name").innerText=e,o.style.transitionDelay=this.options.hideDelay+"ms",o.style.transitionDuration=this.options.hideSpeed+"ms",this.container.appendChild(s),i.el=s,i.selectionEl=n,i.caretEl=r,i.flagEl=o},s.prototype._shiftCursor=function(t,e,n){var r=this.cursors[t];r.range.index>e&&(r.range.index+=n)},s.prototype._hideCursor=function(t){var e=this.cursors[t];e&&e.el.classList.add("hidden")},s.prototype._updateCursor=function(t){if(t&&t.range){var e=t.range.index,n=t.range.index+t.range.length;n>this.quill.getLength()-1&&(n=this.quill.getLength()-1);var r,i=this.quill.container.getBoundingClientRect(),s=this.quill.getLeaf(e),l=this.quill.getLeaf(n),a=document.createRange();if(!s||!l||!s[0]||!l[0]||s[1]<0||l[1]<0||!s[0].domNode||!l[0].domNode)return console.warn({startLeaf:s,endLeaf:l}),console.warn("[quill-cursors] A cursor couldn't be updated (ID "+t.userId+"), hiding."),void this._hideCursor(t.userId);try{a.setStart(s[0].domNode,s[1]),a.setEnd(l[0].domNode,l[1]),r=o.a.getClientRects(a),this._updateCaret(t,l),this._updateSelection(t,r,i)}catch(t){console.log({startLeaf:s,endLeaf:l}),console.log(t)}}},s.prototype._updateCaret=function(t,e){var n,r=t.range.index+t.range.length;r>0&&0===e[1]&&t.range.index!==t.range.index+t.range.length&&r--,n=this.quill.getBounds(r),t.caretEl.style.top=n.top+"px",t.caretEl.style.left=n.left+"px",t.caretEl.style.height=n.height+"px",t.flagEl.style.top=n.top+"px",t.flagEl.style.left=n.left+"px"},s.prototype._updateSelection=function(t,e,n){t.selectionEl.innerHTML=null;var r,o=[];[].forEach.call(e,function(e){r=""+e.top+e.left+e.width+e.height,!~o.indexOf(r)&&e.width>1&&(o.push(r),t.selectionEl.appendChild(function(t){var e=document.createElement("span");return e.classList.add("ql-cursor-selection-block"),e.style.top=t.top-n.top+"px",e.style.left=t.left-n.left+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e}(e)))},this)},e.default=s},function(t,e,n){var r,o;void 0===(o="function"==typeof(r=function(){var t,e={};function n(){var e,n,r,o,i,s,l,a;return void 0===t&&(n=document.createElement("p"),r=document.createElement("span"),o=document.createTextNode("aa"),i=document.createTextNode("aa"),(s=document.createElement("img")).setAttribute("src","#null"),l=document.createRange(),t={},n.appendChild(o),n.appendChild(r),r.appendChild(s),r.appendChild(i),document.body.appendChild(n),l.setStart(o,1),l.setEnd(r,0),t.getClientRects=t.getBoundingClientRect=l.getClientRects().length>1,t.getClientRects||(l.setEnd(i,1),t.getClientRects=t.getBoundingClientRect=l.getClientRects().length<3),t.getBoundingClientRect||(l.setEnd(l.startContainer,l.startOffset),e=l.getBoundingClientRect(),t.getBoundingClientRect=0===e.top&&0===e.left),document.body.removeChild(n),a=window.ActiveXObject&&new Function("/*@cc_on return @_jscript_version; @*/")(),t.ieZoom=a&&a<=10),t}function r(t){var e;return t?screen.deviceXDPI===screen.logicalXDPI?t:"length"in t?Array.prototype.map.call(t,r):(e=screen.deviceXDPI/screen.logicalXDPI,{top:t.top/e,bottom:t.bottom/e,left:t.left/e,right:t.right/e,width:t.width/e,height:t.height/e}):t}function o(t,e){var n,r=0;if(1024>=e.length)return Array.prototype.push.apply(t,e);for(;r<e.length;)n=Array.prototype.push.apply(t,Array.prototype.slice.call(e,r,r+1024)),r+=1024;return n}return e.getClientRects=function(t){var e,i,s,l,a=n();if(a.ieZoom)return r(t.getClientRects());if(!a.getClientRects)return t.getClientRects();for(e=[],i=t.endContainer,s=t.endOffset,l=document.createRange();i!==t.commonAncestorContainer;)l.setStart(i,0),l.setEnd(i,s),o(e,l.getClientRects()),s=Array.prototype.indexOf.call(i.parentNode.childNodes,i),i=i.parentNode;return(l=t.cloneRange()).setEnd(i,s),o(e,l.getClientRects()),e},e.getBoundingClientRect=function(t){var e,o,i,s,l,a,c=this.getClientRects(t);if(0===c.length)return null;if(l=t.getBoundingClientRect(),(a=n()).ieZoom)return r(l);if(!a.getBoundingClientRect)return l;if(0===l.width&&0===l.height)return c[0];for(e=0,o=c.length;e<o;e++)s=c[e],i?(i.left=Math.min(i.left,s.left),i.top=Math.min(i.top,s.top),i.right=Math.max(i.right,s.right),i.bottom=Math.max(i.bottom,s.bottom)):i={left:s.left,top:s.top,right:s.right,bottom:s.bottom};return i&&(i.width=i.right-i.left,i.height=i.bottom-i.top),i},e})?r.call(e,n,e,t):r)||(t.exports=o)}]).default});